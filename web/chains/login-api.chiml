ins: state
out: response

do:
  - parallel:
    - |config <-- state.config
    - |query <-- state.request.query
    - |body <-- state.request.body
    - |jwtTokenName <-- config.jwtTokenName

  - if: (query.user == 'root' && query.password == 'toor') || (body.user == 'root' && body.password == 'toor')
    do:

    - ins:
      - id: 0
        user: 'root'
      - config.jwtSecret
      out: jwtToken
      do: |{$.loadJs('jsonwebtoken', 'sign')}

    - |({token: jwtToken, success: true, errorMessage: ''}) --> response.data
    - |(jwtToken) --> response.cookies[jwtTokenName]

    else: |({token: '', success: false, errorMessage: 'Invalid username or password'}) --> response.data