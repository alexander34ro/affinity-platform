ins: action, migrationConfig
out: output
vars:
  schemas:
    - name: 'cck'
      collectionName: 'web_cck'
      insertGroups: ['superAdmin']
      updateGroups: ['superAdmin']
      deleteGroups: ['superAdmin']
      selectGroups: ['superAdmin']
      fields:
        name: {}
        collectionName: {}
        fields:
          inputTemplate: '<%- cck.input.jsonText %>'
          tabularPresentationTemplate: '<%- cck.presentation.text %>'
          presentationTemplate: '<%- cck.presentation.jsonText %>'
        insertGroups:
          caption: 'Insert Privileges'
          inputTemplate: '<%- cck.input.jsonText %>'
        updateGroups:
          caption: 'Update Privileges'
          inputTemplate: '<%- cck.input.jsonText %>'
        deleteGroups:
          caption: 'Delete Privileges'
          inputTemplate: '<%- cck.input.jsonText %>'
        selectGroups:
          caption: 'Select Privileges'
          inputTemplate: '<%- cck.input.jsonText %>'
    - name: 'routes'
      collectionName: 'web_routes'
      insertGroups: ['superAdmin']
      updateGroups: ['superAdmin']
      deleteGroups: ['superAdmin']
      selectGroups: ['superAdmin']
      fields:
        name: {}
        route: {}
        groups:
          inputTemplate: '<%- cck.input.jsonText %>'
        view:
          inputTemplate: '<%- cck.input.codeText %>'
          tabularPresentationTemplate: '<%- cck.presentation.trimmedText %>'
          presentationTemplate: '<%- cck.presentation.codeText %>'
        method:
          inputTemplate: '<%- cck.input.option %>'
          presentationTemplate: '<%- cck.presentation.option %>'
          options:
            all: 'All Methods'
            get: 'GET'
            post: 'POST'
            put: 'PUT'
            patch: 'PATCH'
            delete: 'DELETE'
            copy: 'COPY'
            head: 'HEAD'
            options: 'OPTIONS'
            link: 'LINK'
            unlink: 'UNLINK'
            purge: 'PURGE'
            lock: 'LOCK'
        chain:
          tabularPresentationTemplate: '<%- cck.presentation.trimmedtext %>'
          presentationTemplate: '<%- cck.presentation.codeText %>'
          inputTemplate: '<%- cck.input.codeText %>'
    - name: 'users'
      collectionName: 'web_users'
      insertGroups: ['superAdmin']
      updateGroups: ['superAdmin']
      deleteGroups: ['superAdmin']
      selectGroups: ['superAdmin']
      fields:
        username: {}
        email: {}
        password: {}
        groups: {}
    - name: 'configs'
      collectionName: 'web_configs'
      insertGroups: ['superAdmin']
      updateGroups: ['superAdmin']
      deleteGroups: ['superAdmin']
      selectGroups: ['superAdmin']
      fields:
        key: {}
        value:
          inputTemplate: '<%- cck.input.jsonText %>'
          tabularPresentationTemplate: '<%- cck.presentation.trimmedText %>'
          presentationTemplate: '<%- cck.presentation.jsonText %>'
    - name: 'tests'
      collectionName: 'web_tests'
      fields:
        key: {}
        value: {}

do:

  - if: action == 'up'
    do:
      # upgrade
      - |(schemas) -> [$.cck.createSchema]

    else:
      # downgrade
      - |(schemas) -> [$.cck.removeSchema]
